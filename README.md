# contract-vulnerability-action [![Build Docker image](https://github.com/outdef/contract-vulnerability-action/actions/workflows/build-docker.yaml/badge.svg)](https://github.com/outdef/contract-vulnerability-action/actions/workflows/build-docker.yaml) [![Lint Dockerfile](https://github.com/outdef/contract-vulnerability-action/actions/workflows/lint-docker.yaml/badge.svg)](https://github.com/outdef/contract-vulnerability-action/actions/workflows/lint-docker.yaml)

The Contract Vulnerability GitHub Action is designed to simplify the implementation of robust continuous integration and continuous deployment (CI/CD) practices by providing an integrated solution for code analysis. It combines three powerful code analyzers – [Slither](https://github.com/crytic/slither/), [Echidna](https://github.com/crytic/echidna), and [Mythril](https://github.com/ConsenSys/mythril) – to offer comprehensive static and dynamic analysis for smart contract development. This action aims to assist developers in identifying potential vulnerabilities, security risks, and quality issues in their codebase, ensuring the delivery of secure and reliable smart contracts.

## Use Cases

The Contract Vulnerability GitHub Action can be utilized in various scenarios, including:

- Preventing Vulnerabilities: By running this action as part of your CI/CD pipeline, you can proactively detect potential vulnerabilities and security flaws in your smart contract codebase. This helps in identifying common security issues, such as reentrancy bugs, unchecked send calls, or uninitialized storage variables, leading to more secure smart contracts.

- Maintaining Code Quality: The action performs static analysis to highlight potential coding issues, adherence to best practices, and coding standards in your smart contracts. By identifying potential bugs, dead code, or code smells, it helps ensure the overall quality and maintainability of your codebase.

- Enabling Continuous Integration: Incorporate this action into your CI pipeline to automatically analyze your smart contract code with every code commit or pull request. By identifying issues early in the development cycle, you can address them promptly, reducing the chances of introducing bugs or vulnerabilities into the codebase.

- Supporting Secure Deployment: Leveraging dynamic analysis tools, the action helps validate the behavior of your smart contracts in different scenarios and under various test cases. This assists in ensuring the reliability and security of your smart contract deployments.

- Facilitating Code Reviews: The Contract Vulnerability GitHub Action provides additional insights for code reviews, allowing reviewers to focus on potential vulnerabilities, code quality improvements, and security considerations. This enhances the review process and facilitates collaboration among team members.

## How to use

### Echidna

| Key                  | Description                                                                                  |
| -------------------- | -------------------------------------------------------------------------------------------- |
| `files`              | Solidity files or folders to analyze.                                                        |
| `contract`           | Contract to analyze.                                                                         |
| `config`             | Config file (CLI arguments override config options).                                         |
| `format`             | Output format: json, text, none. Disables interactive UI.                                    |
| `corpus-dir`         | Directory to store corpus and coverage data.                                                 |
| `test-mode`          | Type of tests to be performed: property, assertion, overflow, optimization, exploration.     |
| `multi-abi`          | Use multi-abi mode of testing.                                                               |
| `test-limit`         | Number of sequences of transactions to generate during testing.                              |
| `shrink-limit`       | Number of tries to attempt to shrink a failing sequence of transactions.                     |
| `seq-len`            | Number of transactions to generate during testing.                                           |
| `contract-addr`      | Address to deploy the contract to test.                                                      |
| `deployer`           | Address of the deployer of the contract to test.                                             |
| `sender`             | Addresses to use for the transactions sent during testing.                                   |
| `seed`               | Run with a specific seed.                                                                    |
| `crytic-args`        | Additional arguments to use in crytic-compile for the compilation of the contract to test.   |
| `solc-args`          | Additional arguments to use in solc for the compilation of the contract to test.             |
| `solc-version`       | Version of the Solidity compiler to use.                                                     |
| `output-file`        | Capture echidna-test's output into a file. The path must be relative to the repository root. |
| `echidna-version`    | Version of the Echidna Docker image to use.                                                  |
| `negate-exit-status` | Apply logical NOT to echidna-test's exit status (for testing the action).                    |
| `echidna-workdir`    | Path to run echidna-test from. Note that `files` and `config` are relative to this path.     |

### Slither

| Key              | Description                                                                                                                                                                                    |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `fail-on`        | Cause the action to fail if Slither finds any issue of this severity or higher. See [action fail behavior](#action-fail-behavior).                                                             |
| `sarif`          | If provided, the path of the SARIF file to produce, relative to the repo root.                                                                                                                 |
| `slither-args`   | Extra arguments to pass to Slither.                                                                                                                                                            |
| `slither-config` | The path to the Slither configuration file. By default, `./slither.config.json` is used if present. See [Configuration file](https://github.com/crytic/slither/wiki/Usage#configuration-file). |
| `target`         | The path to the root of the project to be analyzed by Slither. It can be a directory or a file, and it defaults to the repo root or `echidna-workdir` if set.                                  |

### Mythril

| Key                | Description                                                                             |
| ------------------ | --------------------------------------------------------------------------------------- |
| `mythril-args`     | Extra arguments to pass to Mythril.                                                     |
| `mythril-contract` | The path of the contracts to analyze, relative to the repo root. (comma-separated list) |

## Outputs

| Key           | Description                                                                              |
| ------------- | ---------------------------------------------------------------------------------------- |
| `output-file` | If produced, the file containing echidna-test's output, relative to the repository root. |

### Action fail behavior

The Slither action supports a `fail-on` option, based on the `--fail-*` flags
added in Slither 0.8.4. To maintain the current action behavior, this option
defaults to `all`. The following table summarizes the action behavior across
different Slither versions. You may adjust this option as needed for your
workflows. If you are setting these options on your config file, set `fail-on:
config` to prevent the action from overriding your settings.

| `fail-on`          | Slither <= 0.8.3          | Slither > 0.8.3               |
| ------------------ | ------------------------- | ----------------------------- |
| `all` / `pedantic` | Fail on any finding       | Fail on any finding           |
| `low`              | Fail on any finding       | Fail on any finding >= low    |
| `medium`           | Fail on any finding       | Fail on any finding >= medium |
| `high`             | Fail on any finding       | Fail on any finding >= high   |
| `none`             | Do not fail on findings   | Do not fail on findings       |
| `config`           | Determined by config file | Determined by config file     |

## Example usage

```yaml
jobs:
  analysis:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: packages/contracts

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v2
        with:
          node-version: "16.x"
          cache: "npm"
      - name: Install dependencies
        run: npm install
      - name: Compile contracts
        run: npx hardhat compile
      - name: Run Analysis
        uses: outdef/contract-vulnerability-action
        with:
          solc-version: 0.8.17
          echidna-workdir: "packages/contracts"
          files: .
          format: "text"
          test-mode: "assertion"
          contract: Token,Stake,DAO
          crytic-args: --hardhat-ignore-compile
          target: "."
          fail-on: "medium"
          slither-config: "packages/contracts/slither.config.json"
          mythril-args: "--solc-json mythril.config.json"
          mythril-contract: "contracts/Token.sol,contracts/Stake.sol,contracts/Dao.sol"
```

## Feedback and Contributions

We appreciate your feedback and contributions to enhance the Contract Vulnerability GitHub Action. If you encounter any issues, have suggestions, or would like to contribute improvements, please open an issue or submit a pull request on the GitHub repository.

Let's build secure and high-quality smart contracts together!
